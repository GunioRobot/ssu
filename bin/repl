#!/usr/bin/env coffee

sys = require 'sys'

usage = (error) ->
  if error
    sys.puts "Error: #{error}"
    process.exit(1)
  else
    sys.puts "Starts a NodeJS REPL and loads the basic SSU library code."

  process.exit(if error then 1 else 0)

args = process.argv[2..]
while arg = args.shift()
  switch arg
    when '-h'
      usage()

    else
      usage "unrecognized option #{arg}"

fs = require 'fs'
path = require 'path'
root = path.join(path.dirname(fs.realpathSync(__filename)), '..')

GLOBAL.dump = (str) ->
  str = str[0..str.length-2] if str.substring(str.length-1) is '\n'
  console.log str

wesroot = "#{root}/application/chrome/content/wesabe"
require.paths.unshift wesroot

{wesabe} = require wesroot
GLOBAL.wesabe = wesabe

require('repl').start('js> ')
